# Director Mode ç¨‹å¼åŒ–å‹•ç•«ç³»çµ±è¨­è¨ˆ

> **æ–‡ä»¶ç¶­è­·è€…**: JR.H  
> **å»ºç«‹æ—¥æœŸ**: 2025.12.24  
> **æœ€å¾Œæ›´æ–°**: 2025.12.24  
> **ç‹€æ…‹**: å·²å¯¦ä½œï¼ˆPhase 1-9 å®Œæˆï¼‰

---

## ç›®éŒ„

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æ ¸å¿ƒè¨­è¨ˆ](#æ ¸å¿ƒè¨­è¨ˆ)
3. [UI è¨­è¨ˆ](#ui-è¨­è¨ˆ)
4. [æŠ€è¡“æ¶æ§‹](#æŠ€è¡“æ¶æ§‹)
5. [è³‡æ–™çµæ§‹](#è³‡æ–™çµæ§‹)
6. [å¯¦ä½œéšæ®µ](#å¯¦ä½œéšæ®µ)
7. [æœªä¾†æ“´å±•](#æœªä¾†æ“´å±•)

---

## åŠŸèƒ½æ¦‚è¿°

### ç›®æ¨™

åœ¨ Director Mode ä¸­æ–°å¢ã€Œç¨‹å¼åŒ–å‹•ç•«ï¼ˆProcedural Animationï¼‰ã€åŠŸèƒ½ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥åœ¨æ™‚é–“è»¸ä¸Šæ”¾ç½®ç¨‹å¼æ§åˆ¶çš„å‹•ç•«æ•ˆæœï¼Œèˆ‡åŸç”Ÿ FBX/Spine å‹•ç•«ä¸¦è¡Œä½¿ç”¨ã€‚

### æ”¯æ´çš„å‹•ç•«é¡å‹

| é¡å‹ | èªªæ˜ | æŒçºŒæ™‚é–“ | å¯èª¿æ•´é•·åº¦ |
|------|------|----------|------------|
| **FadeIn** | æ·¡å…¥ï¼ˆé€æ˜åº¦ 0â†’1ï¼‰ | 30 å¹€ï¼ˆé è¨­ï¼‰ | æ˜¯ |
| **FadeOut** | æ·¡å‡ºï¼ˆé€æ˜åº¦ 1â†’0ï¼‰ | 30 å¹€ï¼ˆé è¨­ï¼‰ | æ˜¯ |

---

## æ ¸å¿ƒè¨­è¨ˆ

### æ–°å¢ä¾†æºé¡å‹

æ“´å±•ç¾æœ‰çš„ `AnimationSourceType`ï¼š

```typescript
// director.types.ts
export type AnimationSourceType = '3d-model' | 'spine' | 'procedural';
```

### ç¨‹å¼åŒ–å‹•ç•«é¡å‹å®šç¾©

```typescript
// ç¨‹å¼åŒ–å‹•ç•«é¡å‹
export type ProceduralAnimationType = 
  | 'fadeIn'    // æ·¡å…¥ï¼ˆæ¼¸è®Šï¼‰
  | 'fadeOut';  // æ·¡å‡ºï¼ˆæ¼¸è®Šï¼‰

// ç¨‹å¼åŒ–å‹•ç•«è¨­å®š
export interface ProceduralAnimationConfig {
  type: ProceduralAnimationType;
  
  // å‹•ä½œæŒçºŒæ™‚é–“ï¼ˆå¹€ï¼‰
  // æ¼¸è®Šé¡å‹ï¼ˆfadeIn/fadeOutï¼‰å¯è¨­å®šæŒçºŒæ™‚é–“
  isInstant: boolean;
  
  // æœªä¾†æ“´å±•ç”¨ï¼ˆç·©å‹•å‡½æ•¸ç­‰ï¼‰
  easing?: 'linear' | 'easeIn' | 'easeOut' | 'easeInOut';
}
```

### DirectorClip æ“´å±•

```typescript
export interface DirectorClip {
  // ... ç¾æœ‰æ¬„ä½ ...
  
  // ç¨‹å¼åŒ–å‹•ç•«å°ˆç”¨æ¬„ä½ï¼ˆsourceType === 'procedural' æ™‚ä½¿ç”¨ï¼‰
  proceduralType?: ProceduralAnimationType;
  proceduralConfig?: ProceduralAnimationConfig;
  
  // æ³¨æ„ï¼šç¨‹å¼å‹•ä½œä½¿ç”¨ sourceModelId ä½œç‚ºç›®æ¨™æ¨¡å‹
  // å› ç‚ºç¨‹å¼å‹•ä½œæ˜¯å¾ç‰¹å®šæ¨¡å‹çš„å‹•ä½œåˆ—è¡¨ä¸­æ‹–æ”¾çš„ï¼Œè‡ªå‹•ç¶å®šè©²æ¨¡å‹
}
```

---

## UI è¨­è¨ˆ

### å‹•ä½œä¾†æºé¢æ¿ï¼ˆActionSourcePanelï¼‰

åœ¨æ¯å€‹æ¨¡å‹çš„å‹•ä½œåˆ—è¡¨æœ€ä¸‹æ–¹æ–°å¢ã€Œ+ ç¨‹å¼å‹•ä½œã€æŒ‰éˆ•ï¼š

```
ğŸ“‚ 3D æ¨¡å‹
  â””â”€ â–¼ 251128                         â† å±•é–‹æ¨¡å‹
      â”œâ”€ BigWinEnd           1.00
      â”œâ”€ GoodFortuneBoy     16.30
      â”œâ”€ Idle_1              2.13
      â”œâ”€ Idle_2              2.13
      â”œâ”€ Hurt                0.50
      â”œâ”€ BigWinIngame        2.00
      â”œâ”€ BigWinIdle          2.00
      â”œâ”€ BigWinReday         1.00
      â”œâ”€ BigWinDrawOut       0.50
      â”œâ”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â† åˆ†éš”ç·š
      â”œâ”€ FadeIn âš™           30f       â† å·²åŠ å…¥çš„ç¨‹å¼å‹•ä½œï¼ˆå¯åˆªé™¤/ç·¨è¼¯ï¼‰
      â”œâ”€ FadeOut âš™          30f       â† å·²åŠ å…¥çš„ç¨‹å¼å‹•ä½œ
      â””â”€ [+ ç¨‹å¼å‹•ä½œ]                  â† é»æ“Šæ–°å¢ç¨‹å¼å‹•ä½œ

ğŸ“‚ Spine å‹•ç•«
  â””â”€ ...
```

### æ–°å¢ç¨‹å¼å‹•ä½œæµç¨‹

1. ç”¨æˆ¶é»æ“Šæ¨¡å‹ä¸‹æ–¹çš„ã€Œ+ ç¨‹å¼å‹•ä½œã€æŒ‰éˆ•
2. å³å´å½ˆå‡ºé¸é …é¢æ¿ï¼Œé¡¯ç¤ºå¯ç”¨çš„ç¨‹å¼å‹•ä½œé¡å‹
3. ç”¨æˆ¶é¸æ“‡å‹•ä½œé¡å‹ï¼ˆFadeInã€FadeOutï¼‰
4. è©²å‹•ä½œåŠ å…¥åˆ°è©²æ¨¡å‹çš„å‹•ä½œåˆ—è¡¨ä¸­
5. ä¹‹å¾Œå¯åƒåŸç”Ÿå‹•ç•«ä¸€æ¨£æ‹–æ”¾åˆ°æ™‚é–“è»¸

#### é¸é …é¢æ¿ UI

é»æ“Šã€Œ+ ç¨‹å¼å‹•ä½œã€å¾Œï¼Œåœ¨å³å´æˆ–å½ˆå‡ºé¡¯ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¸æ“‡ç¨‹å¼å‹•ä½œ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ… FadeIn   æ·¡å…¥æ•ˆæœ   (30f)   â”‚
â”‚  ğŸŒ† FadeOut  æ·¡å‡ºæ•ˆæœ   (30f)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¨‹å¼å‹•ä½œåˆ—è¡¨é …

åŠ å…¥å¾Œçš„ç¨‹å¼å‹•ä½œé¡¯ç¤ºåœ¨æ¨¡å‹çš„å‹•ä½œåˆ—è¡¨ä¸­ï¼š

```
â”œâ”€ FadeIn âš™           30f       
â”‚     â”‚                 â”‚
â”‚     â”‚                 â””â”€ æŒçºŒæ™‚é–“ï¼ˆå¹€ï¼‰
â”‚     â””â”€ é½’è¼ªåœ–ç¤ºï¼šé»æ“Šå¯ç·¨è¼¯/åˆªé™¤
â””â”€ å‹•ä½œåç¨±
```

- **é½’è¼ªåœ–ç¤º âš™**ï¼šé»æ“Šé–‹å•Ÿç·¨è¼¯é¸å–®
- **å³éµé¸å–®**ï¼šåŒæ¨£å¯é–‹å•Ÿç·¨è¼¯é¸å–®
- **æ‹–æ”¾**ï¼šå¯æ‹–æ”¾åˆ°æ™‚é–“è»¸

#### ç·¨è¼¯é¸å–®ï¼ˆé½’è¼ª/å³éµï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç·¨è¼¯æŒçºŒæ™‚é–“...         â”‚  â† FadeIn/FadeOut å¯ç”¨
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ åˆªé™¤                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **æ³¨æ„**ï¼šç›®å‰çš„å…©å€‹å‹•ä½œï¼ˆFadeIn/FadeOutï¼‰ä¸éœ€è¦è¤‡é›œç·¨è¼¯ï¼Œ
> æ­¤é¸å–®é ç•™çµ¦æœªä¾†æ›´è¤‡é›œçš„ç¨‹å¼å‹•ä½œä½¿ç”¨ã€‚

### ClipBlock æ¨£å¼

ç¨‹å¼åŒ–å‹•ç•«åœ¨æ™‚é–“è»¸ä¸Šä½¿ç”¨ç‰¹æ®Šæ¨£å¼å€åˆ†ï¼š

| é¡å‹ | æ¨£å¼ | é è¨­å¹€æ•¸ | å¯èª¿æ•´æ™‚é•· |
|------|------|----------|------------|
| FadeIn | æ¼¸å±¤ï¼ˆé€æ˜â†’é¡è‰²ï¼‰ï¼Œå¯ä¼¸ç¸® | 30 | æ˜¯ï¼ˆæ‹–æ›³é‚Šç·£ï¼‰ |
| FadeOut | æ¼¸å±¤ï¼ˆé¡è‰²â†’é€æ˜ï¼‰ï¼Œå¯ä¼¸ç¸® | 30 | æ˜¯ï¼ˆæ‹–æ›³é‚Šç·£ï¼‰ |

### æ‹–æ”¾åˆ°è»Œé“çš„è¡Œç‚º

1. ç¨‹å¼å‹•ä½œå·²ç¶å®šåˆ°ç‰¹å®šæ¨¡å‹ï¼Œæ‹–æ”¾æ™‚è‡ªå‹•æ”œå¸¶ `sourceModelId`
2. æ”¾ç½®å¾Œç›´æ¥ç”Ÿæ•ˆï¼Œä¸éœ€è¦å†é¸æ“‡ç›®æ¨™æ¨¡å‹
3. æ’­æ”¾æ™‚å½±éŸ¿å°æ‡‰çš„æ¨¡å‹

---

## æŠ€è¡“æ¶æ§‹

### æ¶æ§‹æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ActionSourcePanel                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æ¨¡å‹å‹•ä½œåˆ—è¡¨                                                         â”‚â”‚
â”‚  â”‚  â”œâ”€ åŸç”Ÿå‹•ç•«ï¼ˆFBXï¼‰                                                  â”‚â”‚
â”‚  â”‚  â”œâ”€ ç¨‹å¼å‹•ä½œï¼ˆå·²åŠ å…¥çš„ FadeIn/FadeOutï¼‰                              â”‚â”‚
â”‚  â”‚  â””â”€ [+ ç¨‹å¼å‹•ä½œ] æŒ‰éˆ• â†’ é¸é …é¢æ¿                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ æ‹–æ”¾ï¼ˆæ”œå¸¶ sourceModelIdï¼‰
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TimelineEditor                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ProceduralClipï¼ˆç‰¹æ®Šæ¨£å¼ï¼Œå·²ç¶å®šåˆ°ç‰¹å®šæ¨¡å‹ï¼‰                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ æ’­æ”¾æ™‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       useTimelinePlayback                                â”‚
â”‚  â€¢ åµæ¸¬ç•¶å‰å¹€çš„ç¨‹å¼åŒ– Clip                                               â”‚
â”‚  â€¢ è¨ˆç®— progress (0-1)                                                   â”‚
â”‚  â€¢ ç™¼é€ ProceduralUpdateEvent                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ emitProceduralUpdate()
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        directorEventBus                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ onProceduralUpdate()
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              useDirectorProceduralTrigger + SceneViewer                  â”‚
â”‚  â€¢ è¨‚é–± ProceduralUpdateEvent                                            â”‚
â”‚  â€¢ æ ¹æ“š progress è¨ˆç®— visible / opacity                                  â”‚
â”‚  â€¢ å¥—ç”¨åˆ°ç›®æ¨™æ¨¡å‹çš„ renderState                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº‹ä»¶ç³»çµ±æ“´å±•

åœ¨ `directorEvents.types.ts` æ–°å¢äº‹ä»¶ï¼š

```typescript
/** ç¨‹å¼åŒ–å‹•ç•«æ›´æ–°äº‹ä»¶ */
export interface ProceduralUpdateEvent {
  /** ç›®æ¨™æ¨¡å‹ ID */
  modelId: string;
  /** ç¨‹å¼åŒ–å‹•ç•«é¡å‹ */
  type: ProceduralAnimationType;
  /** é€²åº¦ (0-1)ï¼Œç¬é–“å‹•ç•«ç‚º 0 æˆ– 1 */
  progress: number;
  /** è¨ˆç®—å¾Œçš„ç›®æ¨™å¯è¦‹æ€§ */
  targetVisible: boolean;
  /** è¨ˆç®—å¾Œçš„ç›®æ¨™é€æ˜åº¦ */
  targetOpacity: number;
}
```

### æ¨¡å‹ç‹€æ…‹æ“´å±•

åœ¨ `ModelInstance.ts` æ–°å¢æ¸²æŸ“ç‹€æ…‹å’Œç¨‹å¼å‹•ä½œåˆ—è¡¨ï¼š

```typescript
/** æ¸²æŸ“ç‹€æ…‹ */
export interface ModelRenderState {
  visible: boolean;   // æ˜¯å¦é¡¯ç¤º
  opacity: number;    // é€æ˜åº¦ (0-1)
}

/** å·²åŠ å…¥çš„ç¨‹å¼å‹•ä½œ */
export interface ProceduralAction {
  id: string;                          // å”¯ä¸€è­˜åˆ¥ç¢¼
  type: ProceduralAnimationType;       // å‹•ä½œé¡å‹
  displayName: string;                 // é¡¯ç¤ºåç¨±
  durationFrames: number;              // æŒçºŒå¹€æ•¸
  config?: ProceduralAnimationConfig;  // é€²éšè¨­å®šï¼ˆé ç•™ï¼‰
}

export interface ModelInstance {
  // ... ç¾æœ‰æ¬„ä½ ...
  
  /** æ¸²æŸ“ç‹€æ…‹ï¼ˆç”¨æ–¼ç¨‹å¼å‹•ç•«æ§åˆ¶ï¼‰ */
  renderState: ModelRenderState;
  
  /** å·²åŠ å…¥çš„ç¨‹å¼å‹•ä½œåˆ—è¡¨ */
  proceduralActions: ProceduralAction[];
}
```

---

## è³‡æ–™çµæ§‹

### å®Œæ•´çš„ DirectorClip çµæ§‹

```typescript
interface DirectorClip {
  id: string;
  trackId: string;
  
  // ä¾†æºé¡å‹ï¼ˆæ–°å¢ 'procedural'ï¼‰
  sourceType: '3d-model' | 'spine' | 'procedural';
  
  // 3D æ¨¡å‹ / Spine å…±ç”¨æ¬„ä½
  sourceModelId: string;
  sourceModelName: string;
  sourceAnimationId: string;
  sourceAnimationName: string;
  sourceAnimationDuration: number;
  
  // Spine å°ˆç”¨
  spineInstanceId?: string;
  spineLayerId?: string;
  spineElementId?: string;
  spineSkin?: string;
  
  // ç¨‹å¼åŒ–å‹•ç•«å°ˆç”¨ï¼ˆæ–°å¢ï¼‰
  proceduralType?: ProceduralAnimationType;
  proceduralConfig?: ProceduralAnimationConfig;
  // æ³¨æ„ï¼šç¨‹å¼å‹•ä½œä½¿ç”¨ sourceModelId ä½œç‚ºç›®æ¨™ï¼Œç„¡éœ€é¡å¤–æ¬„ä½
  
  // æ™‚é–“è»¸ä½ç½®
  startFrame: number;
  endFrame: number;
  
  // å‰ªè£è¨­å®š
  trimStart: number;
  trimEnd: number;
  
  // é€²éšè¨­å®š
  speed: number;
  loop: boolean;
  blendIn: number;
  blendOut: number;
  
  // è¦–è¦º
  color: string;
}
```

### é è¨­ç¨‹å¼åŒ–å‹•ç•«å®šç¾©

```typescript
const PROCEDURAL_ANIMATIONS: Record<ProceduralAnimationType, {
  displayName: string;
  defaultDuration: number;  // å¹€æ•¸
  color: string;
}> = {
  fadeIn: {
    displayName: 'FadeIn',
    defaultDuration: 30,
    color: '#4ade80',  // æ·ºç¶ æ¼¸å±¤
  },
  fadeOut: {
    displayName: 'FadeOut',
    defaultDuration: 30,
    color: '#f87171',  // æ·ºç´…æ¼¸å±¤
  },
};
```

---

## å¯¦ä½œéšæ®µ

| éšæ®µ | å…§å®¹ | éœ€ä¿®æ”¹çš„æª”æ¡ˆ | é ä¼°å·¥ä½œé‡ |
|------|------|--------------|------------|
| Phase 1 | é¡å‹å®šç¾© | `director.types.ts`, `directorEvents.types.ts`, `ModelInstance.ts` | å° |
| Phase 2 | ActionSourcePanelã€Œ+ ç¨‹å¼å‹•ä½œã€æŒ‰éˆ• + é¸é …é¢æ¿ | `ActionSourcePanel.tsx` | ä¸­ |
| Phase 3 | ç¨‹å¼å‹•ä½œåˆ—è¡¨é …ï¼ˆé½’è¼ªã€å³éµé¸å–®ã€æ‹–æ”¾ï¼‰ | `ActionSourcePanel.tsx` | ä¸­ |
| Phase 4 | ClipBlock ç¨‹å¼å‹•ä½œç‰¹æ®Šæ¨£å¼ | `ClipBlock.tsx` | ä¸­ |
| Phase 5 | directorStore æ–°å¢ actions | `directorStore.ts` | å° |
| Phase 6 | useTimelinePlayback è™•ç†ç¨‹å¼åŒ– Clip | `useTimelinePlayback.ts` | ä¸­ |
| Phase 7 | æ–°å¢ useDirectorProceduralTrigger | æ–°æª”æ¡ˆ | ä¸­ |
| Phase 8 | SceneViewer è¨‚é–±äº‹ä»¶ä¸¦å¥—ç”¨ renderState | `SceneViewer.tsx` | å¤§ |
| Phase 9 | FadeIn/FadeOut å¯æ‹–æ›³èª¿æ•´æ™‚é•· | `ClipBlock.tsx` | ä¸­ |

### éœ€è¦ä¿®æ”¹çš„æª”æ¡ˆæ¸…å–®

#### Domain å±¤
- `src/domain/entities/director/director.types.ts` - æ–°å¢ ProceduralAnimationType ç­‰é¡å‹
- `src/domain/entities/director/directorEvents.types.ts` - æ–°å¢ ProceduralUpdateEvent
- `src/domain/value-objects/ModelInstance.ts` - æ–°å¢ renderStateã€proceduralActions

#### Infrastructure å±¤
- `src/infrastructure/events/directorEventBus.ts` - æ–°å¢ emitProceduralUpdate / onProceduralUpdate

#### Presentation å±¤
- `src/presentation/stores/directorStore.ts` - æ–°å¢ addProceduralClip
- `src/presentation/features/director/components/ActionSourcePanel.tsx`
  - æ–°å¢ã€Œ+ ç¨‹å¼å‹•ä½œã€æŒ‰éˆ•
  - æ–°å¢ç¨‹å¼å‹•ä½œé¸é …é¢æ¿
  - æ–°å¢ç¨‹å¼å‹•ä½œåˆ—è¡¨é …ï¼ˆå«é½’è¼ªåœ–ç¤ºã€å³éµé¸å–®ï¼‰
- `src/presentation/features/director/components/ClipBlock.tsx` - ç¨‹å¼å‹•ä½œç‰¹æ®Šæ¨£å¼
- `src/presentation/features/director/hooks/useTimelinePlayback.ts` - è™•ç†ç¨‹å¼åŒ– Clip
- æ–°å¢ `src/presentation/features/director/hooks/useDirectorProceduralTrigger.ts`
- `src/presentation/features/scene-viewer/components/SceneViewer.tsx` - è¨‚é–±äº‹ä»¶ä¸¦å¥—ç”¨ renderState

---

## æœªä¾†æ“´å±•

å¯ä»¥ç”¨ç›¸åŒæ¶æ§‹å¯¦ç¾æ›´å¤šç¨‹å¼åŒ–å‹•ç•«ï¼š

| é¡å‹ | èªªæ˜ | å¯èª¿åƒæ•¸ |
|------|------|----------|
| **Move** | å¾ A é»ç§»å‹•åˆ° B é» | èµ·é»ã€çµ‚é»ã€ç·©å‹•å‡½æ•¸ |
| **Scale** | æ”¾å¤§/ç¸®å° | èµ·å§‹æ¯”ä¾‹ã€çµæŸæ¯”ä¾‹ |
| **Rotate** | æ—‹è½‰å‹•ç•« | èµ·å§‹è§’åº¦ã€çµæŸè§’åº¦ã€è»¸å‘ |
| **ColorTint** | é¡è‰²è®ŠåŒ– | èµ·å§‹é¡è‰²ã€çµæŸé¡è‰² |
| **Shake** | æ™ƒå‹•æ•ˆæœ | å¼·åº¦ã€é »ç‡ã€è¡°æ¸› |

### æ“´å±•æ¶æ§‹

```typescript
// æœªä¾†å¯èƒ½çš„ ProceduralAnimationType æ“´å±•
export type ProceduralAnimationType = 
  | 'fadeIn' | 'fadeOut'
  | 'move' | 'scale' | 'rotate'
  | 'colorTint' | 'shake';

// æ¯ç¨®é¡å‹æœ‰è‡ªå·±çš„åƒæ•¸ä»‹é¢
interface MoveConfig extends ProceduralAnimationConfig {
  type: 'move';
  from: { x: number; y: number; z: number };
  to: { x: number; y: number; z: number };
}

interface ScaleConfig extends ProceduralAnimationConfig {
  type: 'scale';
  fromScale: number;
  toScale: number;
}
```

---

*æ­¤æ–‡æª”å°‡éš¨é–‹ç™¼é€²åº¦æŒçºŒæ›´æ–°*

