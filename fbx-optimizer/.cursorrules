# Cursor Rules for FBX Optimizer Project

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°
**JR 3D Viewer / FBX Optimizer** - Web-based 3D æ¨¡å‹æª¢è¦–èˆ‡å„ªåŒ–å·¥å…·
- **æŠ€è¡“æ£§**ï¼šReact 19 + TypeScript + Three.js + Vite
- **æ¶æ§‹**ï¼šDDD åˆ†å±¤æ¶æ§‹ï¼ˆDomain â†’ Application â†’ Infrastructure â†’ Presentationï¼‰

---

## ğŸ—ï¸ å°ˆæ¡ˆçµæ§‹é€ŸæŸ¥

```
src/
â”œâ”€â”€ domain/                    # ç´”æ¥­å‹™é‚è¼¯ï¼ˆç„¡å¤–éƒ¨ä¾è³´ï¼‰
â”‚   â”œâ”€â”€ services/              # AnimationOptimizer, ModelLoaderService...
â”‚   â””â”€â”€ value-objects/         # ModelInstance, ShaderFeature, AudioTrack, Layer...
â”œâ”€â”€ application/use-cases/     # Use Casesï¼ˆéœæ…‹ execute() æ–¹æ³•ï¼‰
â”œâ”€â”€ infrastructure/            # å¤–éƒ¨ API å°è£
â”‚   â”œâ”€â”€ audio/                 # WebAudioAdapter, AudioGraphBuilder
â”‚   â””â”€â”€ effect/                # EffekseerRuntimeAdapter
â”œâ”€â”€ presentation/              # React UI
â”‚   â”œâ”€â”€ features/              # åŠŸèƒ½æ¨¡çµ„ï¼ˆscene-viewer, audio-panel...ï¼‰
â”‚   â”œâ”€â”€ hooks/                 # å…±ç”¨ Hooks
â”‚   â””â”€â”€ components/            # å…±ç”¨çµ„ä»¶ï¼ˆProgressBarï¼‰
â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•¸ï¼ˆarray/, clip/, shader/...ï¼‰
â””â”€â”€ types/                     # é¡å‹å®šç¾©ï¼ˆeffekseer.d.ts, shaderTypes.tsï¼‰
```

---

## âš ï¸ åˆ†å±¤ä¾è³´è¦å‰‡ï¼ˆå¿…éµå®ˆï¼‰

| å±¤ç´š | å¯ä¾è³´ | ç¦æ­¢ä¾è³´ |
|------|--------|----------|
| **Domain** | TypeScript æ¨™æº–åº«ã€Three.js é¡å‹ | Reactã€Applicationã€Infrastructureã€Presentation |
| **Application** | Domainã€Infrastructure | Presentation |
| **Infrastructure** | Domain | Applicationã€Presentation |
| **Presentation** | Applicationã€Domain | Infrastructureï¼ˆé ˆé€é Use Casesï¼‰ |

---

## ğŸ“ å‘½åè¦ç¯„

### æª”æ¡ˆå‘½å
| é¡å‹ | æ ¼å¼ | ç¯„ä¾‹ |
|------|------|------|
| React çµ„ä»¶ | `PascalCase.tsx` | `SceneViewer.tsx` |
| Use Case | `PascalCaseUseCase.ts` | `LoadModelUseCase.ts` |
| Service | `PascalCaseService.ts` | `ModelLoaderService.ts` |
| Hook | `useCamelCase.ts` | `useTheme.ts` |
| å·¥å…·å‡½æ•¸ | `camelCaseUtils.ts` | `arrayUtils.ts` |
| Value Object | `PascalCase.ts` | `AudioTrack.ts` |

### è®Šæ•¸/å‡½æ•¸å‘½å
- **è®Šæ•¸**ï¼š`camelCase`ï¼ˆ`currentTime`, `audioTracks`ï¼‰
- **å¸¸æ•¸**ï¼š`UPPER_CASE`ï¼ˆ`SAMPLE_RATE`ï¼‰
- **é¡åˆ¥/ä»‹é¢**ï¼š`PascalCase`ï¼ˆ`AnimationOptimizer`, `ShaderGroup`ï¼‰
- **å‡½æ•¸**ï¼šå‹•è©é–‹é ­ï¼ˆ`loadModel()`, `createClip()`, `handleTimeUpdate()`ï¼‰
- **Hook**ï¼š`use` å‰ç¶´ï¼ˆ`useTheme()`, `useFileDrop()`ï¼‰

---

## ğŸ”§ ç¨‹å¼ç¢¼é¢¨æ ¼

### TypeScript
```typescript
// âœ… ä½¿ç”¨ interface å®šç¾©ç‰©ä»¶çµæ§‹
interface LoadModelParams {
  files: File[];
  onProgress?: (percent: number) => void;
}

// âœ… Use Case éœæ…‹ execute æ–¹æ³•
class LoadModelUseCase {
  static async execute(params: LoadModelParams): Promise<LoadModelResult> { }
}

// âœ… æ˜ç¢ºé¡å‹ï¼Œé¿å… any
const tracks: AudioTrack[] = [];
```

### React
```typescript
// âœ… å‡½æ•¸çµ„ä»¶ + TypeScript Props
interface SceneViewerProps {
  model: THREE.Group | null;
  onTimeUpdate: (time: number) => void;
}

export const SceneViewer = forwardRef<SceneViewerRef, SceneViewerProps>(
  ({ model, onTimeUpdate }, ref) => { }
);

// âœ… ä½¿ç”¨ useCallback/useMemo å„ªåŒ–ï¼ˆç•¶ä½œç‚º props å‚³éæ™‚ï¼‰
const handlePlay = useCallback(() => { }, [deps]);
```

### å‡½æ•¸å¼æ›´æ–°
```typescript
// âœ… ä¸å¯è®Šæ›´æ–°
setTracks(prev => prev.map(t => t.id === id ? { ...t, volume } : t));

// âœ… ä½¿ç”¨å·¥å…·å‡½æ•¸
import { updateArrayItemById } from './utils/array/arrayUtils';
setTracks(prev => updateArrayItemById(prev, id, { volume }));
```

---

## ğŸ¯ æ ¸å¿ƒé¡å‹é€ŸæŸ¥

### ModelInstanceï¼ˆæ¨¡å‹å¯¦ä¾‹ï¼‰
```typescript
interface ModelInstance {
  id: string;
  model: THREE.Group | null;
  meshNames: string[];
  originalClip: IdentifiableClip | null;
  createdClips: IdentifiableClip[];
  shaderGroups: ShaderGroup[];
  audioTracks: AudioTrack[];
  effects: EffectItem[];
}
```

### Layerï¼ˆ2D åœ–å±¤ï¼‰
```typescript
interface Layer {
  id: string;
  type: '3d' | '2d';
  priority: number;  // >0: å‰æ™¯, =0: 3D, <0: èƒŒæ™¯
  children: Element2D[];
}
```

### IdentifiableClipï¼ˆå¯è­˜åˆ¥å‹•ç•«ç‰‡æ®µï¼‰
```typescript
interface IdentifiableClip extends THREE.AnimationClip {
  customId: string;      // å”¯ä¸€ ID
  displayName: string;   // é¡¯ç¤ºåç¨±
}
```

---

## ğŸš« ç¦æ­¢äº‹é …

1. âŒ Domain å±¤ä½¿ç”¨ React Hooks æˆ– Three.js ç‰©ä»¶å¯¦ä¾‹
2. âŒ Presentation å±¤ç›´æ¥å‘¼å« Infrastructure
3. âŒ ä½¿ç”¨ `any` é¡å‹ï¼ˆç”¨ `unknown` æˆ–å…·é«”é¡å‹ï¼‰
4. âŒ ç›´æ¥ä¿®æ”¹ props æˆ–ç‹€æ…‹
5. âŒ åœ¨çµ„ä»¶ä¸­å¯«è¤‡é›œæ¥­å‹™é‚è¼¯ï¼ˆç§»è‡³ Use Casesï¼‰
6. âŒ æ¨¡ç³Šè®Šæ•¸åï¼ˆ`data`, `temp`, `obj`ï¼‰
7. âŒ åœ¨ `src/components/` æ ¹ç›®éŒ„å»ºæ–°æª”æ¡ˆ

---

## âœ… æœ€ä½³å¯¦è¸

1. **æ–°å¢åŠŸèƒ½**ï¼šåœ¨ `presentation/features/[name]/` å‰µå»ºæ¨¡çµ„
2. **æ¥­å‹™é‚è¼¯**ï¼šå°è£åœ¨ Use Casesï¼ˆ`application/use-cases/`ï¼‰
3. **è³‡æ–™çµæ§‹**ï¼šå®šç¾©ç‚º Value Objectï¼ˆ`domain/value-objects/`ï¼‰
4. **å¤–éƒ¨ API**ï¼šå°è£åœ¨ Infrastructureï¼ˆ`infrastructure/`ï¼‰
5. **å…±ç”¨é‚è¼¯**ï¼šæå–ç‚º Hookï¼ˆ`presentation/hooks/`ï¼‰
6. **å·¥å…·å‡½æ•¸**ï¼šæ”¾åœ¨ `utils/[category]/`

---

## ğŸ“– åƒè€ƒæ–‡æª”

- **æ¶æ§‹è©³è§£**ï¼š`PROJECT_ARCHITECTURE.md`
- **æŠ€è¡“ä¸Šä¸‹æ–‡**ï¼š`PROJECT_CONTEXT.md`
